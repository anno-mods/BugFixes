<ModOps>
    
  <!-- ############################################################ -->
    <!-- QUESTS -->
    <!-- ############################################################ -->
    
    <!-- TODO: -->
      <!-- Alle ActionDeleteObjects des Starter Schiffs zb in OnQuestDeclined usw.  -->
       <!-- sind bullshit, vorallem da kein ObjectRestrictToQuestObjects dabei ist. (aktuell entfernt es weltweit alle Questschiffe, auch für andere Spieler) -->
       <!-- Also entweder das zufügen oder einfach alle davon entfernen, weil das Starter Schiff schon von alleine die map verlässt -->
        <!-- außer es ist <ObjectDespawn>StayOnMap</ObjectDespawn> im StarterObject definiert. -->
      <!-- Wobei <ObjectDespawn>StayOnMap</ObjectDespawn> bei Starter Objekten auch absoluter Quatsch ist, außer evlt bei QuestLines -->
       <!-- Bei Mercier sorgt das bei manchen Quests wohl dafür, dass sie unendlich seiner Schiffe sammeln. -->
       <!-- Also auch diese Zeile überall entfernen. -->
        <!-- und nach <PrebuiltObject>110688</PrebuiltObject> suchen (starter schiff) -->
         <!-- und dies durch ConditoinSpawn ersetzen, damit neues starterschiff spawned -->
    
    
    <!-- There are several deliver quests from Ketema that asks you to send him goods with value of 100k and more, to get like 10k as reward... -->
    <!-- (this is more of a bugfix I think, cause other questgivers already have money amount=3 already defined for expensive deliver quests like this) -->
    <ModOp Type="merge" GUID="119041,119040,119038,119042,119043,119044" Path="/Values/Reward/RewardAssets/Item[1]">
      <Amount>3</Amount>
    </ModOp>
    
    <!-- Fix some delivery Quests which ask for money on the island, while money is a Meta product, which is why the quests are not solveable -->
    <ModOp Type="replace" GUID="119016,151543,110881,118964" Path="/Values/Objectives/WinConditions/Item/Objective/Values/ConditionQuestDelivery[DeliveryObject_cqd/Item/ObjectGUID='1010017']/DeliveryType">
      <DeliveryType>Meta</DeliveryType>
    </ModOp>
    <!-- fix text that mentions "t"/"tons" while we delivery money -->
    <ModOp Type="replace" GUID="119016" Path="/Values/Objectives/WinConditions/Item/Objective/Values[ConditionQuestDelivery/DeliveryObject_cqd/Item/ObjectGUID='1010017']/ConditionQuestObjective/TextCombinedContextValue">
      <TextCombinedContextValue>22071</TextCombinedContextValue>
    </ModOp>
    <!-- and the quest asks you for 20k money (scaled) and yield like ~13k money... so lets multiply the reward also for this quest -->
    <ModOp Type="merge" GUID="119016" Path="/Values/Reward/RewardAssets/Item[1]">
      <Amount>3</Amount>
    </ModOp>
    
    
    <!-- Adjust some arctic Quests which require you to own a Boreas Airship all the time to trigger again. This makes no sense anymore since there are other better airhsips now to eg. collect arctic scrap. -->
     <!-- We will change these quests to instead check "did the player own at any time at least 1 Boreas", since it seems the quests only care for the progress not for an actual airship -->
    <!-- LostCargo_Pool -->
    <ModOp Type="merge" GUID="116887" Path="/Values/PreConditionList/SubConditions/Item/SubCondition/Values/PreConditionList/Condition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    <!-- LostCargo_QuestVariationPool -->
    <ModOp Type="merge" GUID="117260" Path="/Values/PreConditionList/Condition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    <!-- Lost Cargo Scrap Quests -->
    <ModOp Type="merge" GUID="115979,116889,116890,116891,116892,116893,116894,116895,117279,117280,117281,117282,117283,117284,117285,117286,117287,117288,117289,117290,117399,117400,117401,117402,117403,117404,117405,117406,117407,117408,117409,117410,117411,117412,117413,117414" Path="/Values/PreConditionList/Condition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    <!-- Lost Cargo Items Quests -->
    <ModOp Type="merge" GUID="117415,117417,117418,117419" Path="/Values/PreConditionList/Condition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    <!-- a few Inuit Quests -->
    <ModOp Type="merge" GUID="116747,116841,116864,116865,116866" Path="/Values/PreConditionList/SubConditions/Item/SubCondition/Values/PreConditionList/Condition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    <!-- Explorer Lost Cargo variation -->
    <ModOp Type="merge" GUID="117115,117119,117120" Path="/Values/PreConditionList/Condition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    <!-- same for Triggers Intermediate Arctic 2.1.1 Inventions, makes no sense to force players to own Boreas all the time -->
    <ModOp Type="merge" GUID="116659,116660,116661,130277,130276,130278,116664,130281,130282,130280" Path="/Values/Trigger/SubTriggers/Item/SubTrigger/Values/Trigger/TriggerCondition/Values/ConditionPlayerCounter[Context='114166']">
      <CounterValueType>Max</CounterValueType>
    </ModOp>
    
    <!-- Quest 153187 is a subquest from 153176 and asks you to build a "aquatic enclosure". The Quests lists specific buildings in the wincondition -->
     <!-- while with mods and maybe also DLCs new aquatic enclosure were added, which do not count for the Quest. -->
      <!-- So we add a QuestHint for this Quest that mentions the allowed objects -->
    <ModOp Type="merge" GUID="153176" Path="/Values/Quest">
      <QuestHints />
    </ModOp>
    <ModOp Type="add" GUID="153176" Path="/Values/Quest/QuestHints">
      <Item>
        <Text>1500005603</Text>
      </Item>
    </ModOp>
  
  <!-- ################################################### -->
  <!-- Uses Serp GUIDS: 1500005526 -->

  <!-- Fix campaign being unable to upgrade more farmers to workers -->
  <!-- Campaign has a trigger 153245 that relocks the workers again as soon as you unlocked basic-clothes-chain -->
  <!-- The Trigger to unlock it again is 150560 which triggers as soon as you completed the Quest 150841 (Freedom and the Free Press) -->
   <!-- If you now complete this Quest before you reach clothes, the "again unlock" triggers before the relock, because it lacks proper conditions. -->
   <!-- Instead of fixing the vanilla triggers, we will add a new Trigger that uses proper conditions (fixing vanilla would not resolve savegames) -->
    <!-- So before we unlock workers we check: 1) is Quest 150841 completed. 2) are clothes unlocked? 3) are workers locked -->
     <!-- this will make sure it unlocks it correctly and also in savegames. -->
  <ModOp Type="addNextSibling" GUID="150560">
    <Asset>
      <Template>Trigger</Template>
      <Values>
        <Standard>
          <GUID>1500005526</GUID>
          <Name>Campaign_UnlockResidenceLvl2_Fix</Name>
        </Standard>
        <Trigger>
          <TriggerCondition>
            <Template>ConditionQuestState</Template>
            <Values>
              <Condition />
              <ConditionQuestState>
                <ConditionQuestStateStates>Reached</ConditionQuestStateStates>
                <ConditionQuestStateQuestGUID>150841</ConditionQuestStateQuestGUID>
              </ConditionQuestState>
            </Values>
          </TriggerCondition>
          <SubTriggers>
            <Item>
              <SubTrigger>
                <Template>AutoCreateTrigger</Template>
                <Values>
                  <Trigger>
                    <TriggerCondition>
                      <Template>ConditionUnlocked</Template>
                      <Values>
                        <Condition />
                        <ConditionUnlocked>
                          <UnlockNeeded>130060</UnlockNeeded>
                        </ConditionUnlocked>
                        <ConditionPropsNegatable />
                      </Values>
                    </TriggerCondition>
                    <SubTriggers>
                      <Item>
                        <SubTrigger>
                          <Template>AutoCreateTrigger</Template>
                          <Values>
                            <Trigger>
                              <TriggerCondition>
                                <Template>ConditionUnlocked</Template>
                                <Values>
                                  <Condition />
                                  <ConditionUnlocked>
                                    <UnlockNeeded>1010344</UnlockNeeded>
                                  </ConditionUnlocked>
                                  <ConditionPropsNegatable>
                                    <NegateCondition>1</NegateCondition>
                                  </ConditionPropsNegatable>
                                </Values>
                              </TriggerCondition>
                            </Trigger>
                          </Values>
                        </SubTrigger>
                      </Item>
                    </SubTriggers>
                  </Trigger>
                </Values>
              </SubTrigger>
            </Item>
          </SubTriggers>
          <TriggerActions>
            <Item>
              <TriggerAction>
                <Template>ActionUnlockAsset</Template>
                <Values>
                  <Action />
                  <ActionUnlockAsset>
                    <UnlockAssets>
                      <Item>
                        <Asset>1010344</Asset>
                      </Item>
                    </UnlockAssets>
                  </ActionUnlockAsset>
                </Values>
              </TriggerAction>
            </Item>
          </TriggerActions>
          <TriggerSetup>
            <AutoRegisterTrigger>1</AutoRegisterTrigger>
            <UsedBySecondParties>0</UsedBySecondParties>
          </TriggerSetup>
        </Trigger>
      </Values>
    </Asset>
  </ModOp>
  
  <!-- #### -->
  
  <!-- Fix Vanilla Quest Bug from Quest 152691 ('Cruise Control' by Gasparov):  -->
    <!-- After the second escort the Quest suddenly asks to deliver 0t of undefined, which makes no sense. Fixed. -->
  <!-- The devs forgot to add ConditionPropsExecutionPlaceSettings/ConditionObjectAnywhere to the second escort (the first and third do have it) -->
  
  <ModOp Type="merge" GUID="152691" Path="/Values/Objectives/WinConditions/Item[2]/Objective/Values">
    <ConditionPropsExecutionPlaceSettings>
      <ExecutionPlace>
        <Template>ConditionObjectAnywhere</Template>
        <Values>
          <ConditionObjectAnywhere />
        </Values>
      </ExecutionPlace>
      <ExecutionPlaceConfirmOnReached>0</ExecutionPlaceConfirmOnReached>
    </ConditionPropsExecutionPlaceSettings>
  </ModOp>
  
  <!-- ########################### -->

  <!-- Photography Quests get automatically aborted by the game when any object you have to Photograph gets destroyed, even if others to Photograph are still there. -->
   <!-- I see no way to prevent the abortion, because it is done outside of xml. -->
   <!-- But at least for Quests without a timelimit, so Quests you are not supposed to fail, we will start them again if they are aborted internally -->
   <!-- Photography Quests which no timelimit: 105406,119884,119924,119925,123955,128923,128926,129675,131501,132095,133232,136264,137304,150846,153175,153177,153178,269854,816 -->
    <!-- abortable: 153175,153177 -->
    <!-- The ones where you have to Photography sth. that can be destroyed: 119884,119925,137304,150846,269854 (AlwaysFalse so not enabled: 153175,153178) -->
  
  <!-- OnQuestDiscarded: Callback when the quest has been automatically aborted by the system. Gets called before OnQuestEnd. -->
  <ModOp Type="merge" GUID="119884,119925,137304,150846,269854" Path="/Values/Quest">
    <OnQuestDiscarded>
      <IsBaseAutoCreateAsset>1</IsBaseAutoCreateAsset>
      <Values>
        <ActionList>
          <Actions />
        </ActionList>
      </Values>
    </OnQuestDiscarded>
  </ModOp>
  <!-- make them rstart 10 seconds later -->
  <ModOp Type="add" GUID="119884,119925,137304,150846,269854" Condition="!/Values/Quest/OnQuestDiscarded/Values/ActionList/Actions/Item/Action/Values/ActionDelayedActions/DelayedActions/Values/ActionList/Actions/Item/Action/Values/ActionStartQuest[Quest='119884']" Path="/Values/Quest/OnQuestDiscarded/Values/ActionList/Actions" Content="/Values/Standard/GUID/text()">
    <Item>
      <Action>
        <Template>ActionDelayedActions</Template>
        <Values>
          <Action />
          <ActionDelayedActions>
            <ExecutionDelay>10000</ExecutionDelay>
            <DelayedActions>
              <IsBaseAutoCreateAsset>1</IsBaseAutoCreateAsset>
              <Values>
                <ActionList>
                  <Actions>
                    <Item>
                      <Action>
                        <Template>ActionStartQuest</Template>
                        <Values>
                          <Action />
                          <ActionStartQuest>
                            <Quest>
                              <ModOpContent></ModOpContent>
                            </Quest>
                            <InheritQuestArea>1</InheritQuestArea>
                            <InheritQuestSession>1</InheritQuestSession>
                            <InheritQuestObjects>1</InheritQuestObjects>
                          </ActionStartQuest>
                        </Values>
                      </Action>
                    </Item>
                  </Actions>
                </ActionList>
              </Values>
            </DelayedActions>
          </ActionDelayedActions>
        </Values>
      </Action>
    </Item>
  </ModOp>
  
  <!-- Ketema asks to photograph a kontor from old world. Make it use the Pool of moderate kontors, instead of listing each vanilla one by one. -->
   <!-- this way also mods kontors are supported -->
  <ModOp Type="replace" GUID="119884" Path="/Values/Objectives/WinConditions">
    <WinConditions>
      <Item>
        <Objective>
          <Template>PhotographyObjective</Template>
          <Values>
            <ConditionQuestObjective>
              <TextCombinedContextValue>119885</TextCombinedContextValue>
              <QuestTrackerIcon>data/ui/2kimages/main/3dicons/icon_kontor_main.png</QuestTrackerIcon>
            </ConditionQuestObjective>
            <ConditionQuestPhotography>
              <PhotographyObjectList>
                <Item>
                  <Entry>
                    <Template>ConditionObjectPrebuiltObject</Template>
                    <Values>
                      <ConditionObjectPrebuiltObject>
                        <PrebuiltObject>135063</PrebuiltObject>
                        <PrebuiltObjectCheckOwner>1</PrebuiltObjectCheckOwner>
                        <PrebuiltUseProcessingParticipant>1</PrebuiltUseProcessingParticipant>
                      </ConditionObjectPrebuiltObject>
                      <ConditionScanner />
                      <ConditionObjectiveSignsAndFeedback />
                    </Values>
                  </Entry>
                </Item>
              </PhotographyObjectList>
            </ConditionQuestPhotography>
            <ConditionPropsExecutionPlaceSettings />
          </Values>
        </Objective>
      </Item>
    </WinConditions>
  </ModOp>
  
  <!-- ########################## -->

  <!-- Several "Jump To" ShowOnlyFakePings are not working in the game for several Quests -->
  <!-- It seems to be caused by using ShowMinimapToken=0, so we will set this to 0 and instead MinimapToken=0. -->
  <!-- Works fine (eg Quests 102911,102912,103841), but does not fix eg. Quest 102988, which tries to jumpto Bauxit-Slot 1372. But this is because of the Bauxit-Slot is buggy, for Goldmine 1309 it works. -->
   <!-- I guess it is of the bad DLC Replacement Code, that the game is unable to identify the new DLC Slots (yes same problem with iron slot in new world) -->
  <ModOp Type="merge" Path="//Values/Objectives/WinConditions/Item/Objective/Values/ConditionQuestObjective[JumpToVisibility='ShowOnlyFakePings']/FakeMinimapPings/Objects/Item[FakeMinimapObjects]/SignsAndFeedback/Values/ConditionObjectiveSignsAndFeedback[ShowMinimapToken='0']">
    <ShowMinimapToken>1</ShowMinimapToken>
    <MinimapToken>0</MinimapToken>
  </ModOp>

</ModOps>